<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Stream RPi Schermo Intero</title>
    <style>
        /* RESET BASE */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* Nasconde le barre di scorrimento */
            background-color: #000; /* Sfondo nero */
        }
        
        /* CONTENITORE VIDEO - Copre l'intera viewport */
        #video-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center; /* Centra orizzontalmente */
            align-items: center; /* Centra verticalmente */
            position: relative;
        }

        /* L'IMMAGINE (IL VIDEO) - Copre il contenitore mantenendo le proporzioni */
        #stream {
            /* Assicura che l'immagine copra il contenitore adattandosi */
            object-fit: contain; /* Adatta l'immagine mantenendo le proporzioni (aggiunge barre nere se necessario) */
            width: 100%;
            height: 100%;
            display: block;
        }

        /* ELEMENTI DI STATO (Opzionale: li nascondiamo ma li teniamo per debug) */
        #status-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            font-family: sans-serif;
            font-size: 14px;
            border-radius: 5px;
        }
    </style>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>

    <div id="video-container">
        <img id="stream" src="" alt="In attesa del video...">
    </div>

    <div id="status-overlay">Stato: <span id="status" style="color: orange;">Disconnesso</span></div>


    <script>
        // --- CONFIGURAZIONE AGGIORNATA ---
        const SERVER_URL = 'https://server-webrtc-mvno.onrender.com';

        const socket = io(SERVER_URL);
        const imgElement = document.getElementById('stream');
        const statusElement = document.getElementById('status');
        const statusOverlay = document.getElementById('status-overlay');

        socket.on('connect', () => {
            statusElement.innerText = "Connesso";
            statusElement.style.color = "lightgreen";
        });

        socket.on('disconnect', () => {
            statusElement.innerText = "Disconnesso";
            statusElement.style.color = "red";
        });

        // Quando arriva il frame dal server
        socket.on('stream_display', (data) => {
            // Aggiorna la sorgente dell'immagine con il dato Base64
            imgElement.src = 'data:image/jpeg;base64,' + data;
            
            // Opzionale: Nascondi l'overlay di stato dopo il primo frame
            if (statusOverlay.style.display !== 'none') {
                 // Rimuovi l'overlay dopo 5 secondi dal primo frame
                 setTimeout(() => { statusOverlay.style.display = 'none'; }, 5000);
            }
        });
    </script>

</body>
</html>
